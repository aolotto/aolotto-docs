# 😄 开奖 & 规则

通常情况下，每一轮投注的开放时间为24小时，奖池的定时触发器每2分钟检查一次，同时满足**间隔时间**和投注**金额下限**才能结束当前轮次，开放下一轮。

1. **间隔时间≥24小时**，当前时间戳和启动时间戳的差值需要大于等于24小时，
2. **投注金额下限≥奖池基础奖金**，每一轮投注启动时都会将前一轮预留的50%计为基础奖金，当前轮次所有用户的累积投注金额大于或等于基础奖金，则满足参与度条件；

### 轮次切换

d

### 抽取幸运号码

轮次结束后的第5个区块高度上开奖并生成幸运号码，幸运号码基于Issac Cipher的随机数函数生成，使用开奖区块的Hash值, 轮次累积投注人数以及数量等无法提前预知因子作为随机函数的种子输入，保证幸运号码生成具有随机性，可验证性和不可预测性：

1. 不可预测性：Arweave的区块Hash是基于区块全部交易内容生成的唯一性ID，采用轮次结束后的第5个区块的hash，意味着任何人在下注期间完全无法预知开奖算法的种子。
2. 可验证性：issac cipher的随机数函数在种子确定的情况下生成的结果也是确定的，意味着通过CU节点生成的幸运号码可被验证，规避CU（计算单元）节点在执行中进行黑箱操作的可能性；
3. 取值分布的随机性：3位数号码并非一次性生成，而是逐位调用随机函数，将统一的种子和位置编号作为输入，分别生成0-9之间的随机数值，保证了3位数号码取值分布的随机性。

<details>

<summary>幸运号码生成算法示例</summary>

```lua
local seed = Block.Hash..Round.TotalBets..Round.Participator

local getLuckyNumber = function(seed,len)
  local numbers = ""
  for i = 1, len or 3 do
    local n = crypto.cipher.issac.random(0, 9, tostring(i)..seed..numbers)
    numbers = numbers .. n
  end
  return numbers
end

local luckyNumber = getLuckyNumber(seed,3)
```

</details>

### 奖金分发

所有中奖的投注将会均分轮次中奖池总额的50%，轮次进行中支持赞助者添加额外的奖金赞助，赞助部分全额计入到本轮奖金中。奖金总额=(奖池基础奖金+用户投注金额)\*0.5 + 赞助金，参与者地址按照中奖投注于总量的占比均分, 中奖者将会在开奖之后，收到又系统下发的\`Reward-Notice\`。
